<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="renderer" content="webkit" />
    <meta name="browsermode" content="application" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1.0, user-scalable=0">
    <title>é¤è´¹è®¡ç®—å™¨</title>
    <link rel="shortcut icon" href="http://kiddingyou.cc/static/img/favicon.ico">
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            font-family: "Microsoft YaHei", "lucida grande", "lucida sans unicode", lucida, helvetica, "Hiragino Sans GB", "WenQuanYi Micro Hei", sans-serif;
            font-size: 12px;
        }

        table {
            margin: 0 auto;
            border-collapse: collapse;
        }

        th {
            background: #2cc36b;
            color: #fff;
        }

        td {
            text-align: center;
        }

        th,
        td {
            padding: 5px 10px;
            border: 1px solid #e3e3e3;
        }

        a {
            color: #666;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        input {
            outline: none;
            text-align: center;
            width: 60px;
            padding-left: 5px;
            padding: 3px 5px;
            border-radius: 3px;
            border: 1px solid #e3e3e3;
        }

        .dont-modify {
            border: none;
        }

        .btn {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            color: #fff;
            background: #2cc36b;
            cursor: pointer;
        }

        h5 {
            text-align: center;
            padding: 5px 0;
        }
    </style>
</head>

<body>
    <div>
        <h5>tips:è¾“å…¥æ¯ä¸ªäººçš„è®¢é¤åŸä»·å’Œä¼˜æƒ é‡‘é¢ï¼Œç‚¹å‡»å¼€å§‹è®¡ç®—ï¼Œè‡ªåŠ¨è®¡ç®—æŠ˜åä»·</h6>
            <table>
                <tr>
                    <th>å§“å</th>
                    <th>åŸä»·</th>
                    <th>é¤è´¹ã€é…é€è´¹</th>
                    <th>æŠ˜å‰ä»·</th>
                    <th>æŠ˜åä»·</th>
                    <th>æ“ä½œ</th>
                </tr>
                <tr>
                    <td>
                        <input type="text" value='è”ºæ¡‚èŠ¬'>
                    </td>
                    <td>
                        <input type="number" class="price-before person">
                    </td>
                    <td>
                        <span class="add-ones-per">0.0</span>
                    </td>
                    <td>
                        <span class="price-before-discount">0.0</span>
                    </td>
                    <td>
                        <span class="price-after">0.0</span>
                    </td>
                    <td>
                        <a href="javascript:;" class="del-btn">ç§»é™¤</a>
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="text" value='å¼ ç£Š'>
                    </td>
                    <td>
                        <input type="number" class="price-before person">
                    </td>
                    <td>
                        <span class="add-ones-per">0.0</span>
                    </td>
                    <td>
                        <span class="price-before-discount">0.0</span>
                    </td>
                    <td>
                        <span class="price-after">0.0</span>
                    </td>
                    <td>
                        <a href="javascript:;" class="del-btn">ç§»é™¤</a>
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="text" value='æœ±ä¸½'>
                    </td>
                    <td>
                        <input type="number" class="price-before person">
                    </td>
                    <td>
                        <span class="add-ones-per">0.0</span>
                    </td>
                    <td>
                        <span class="price-before-discount">0.0</span>
                    </td>
                    <td>
                        <span class="price-after">0.0</span>
                    </td>
                    <td>
                        <a href="javascript:;" class="del-btn">ç§»é™¤</a>
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="text" value='æˆåª›'>
                    </td>
                    <td>
                        <input type="number" class="price-before person">
                    </td>
                    <td>
                        <span class="add-ones-per">0.0</span>
                    </td>
                    <td>
                        <span class="price-before-discount">0.0</span>
                    </td>
                    <td>
                        <span class="price-after">0.0</span>
                    </td>
                    <td>
                        <a href="javascript:;" class="del-btn">ç§»é™¤</a>
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="text" value='ç‹åº†ç£Š'>
                    </td>
                    <td>
                        <input type="number" class="price-before person">
                    </td>
                    <td>
                        <span class="add-ones-per">0.0</span>
                    </td>
                    <td>
                        <span class="price-before-discount">0.0</span>
                    </td>
                    <td>
                        <span class="price-after">0.0</span>
                    </td>
                    <td>
                        <a href="javascript:;" class="del-btn">ç§»é™¤</a>
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="text" value='å¼ é’å±±'>
                    </td>
                    <td>
                        <input type="number" class="price-before person">
                    </td>
                    <td>
                        <span class="add-ones-per">0.0</span>
                    </td>
                    <td>
                        <span class="price-before-discount">0.0</span>
                    </td>
                    <td>
                        <span class="price-after">0.0</span>
                    </td>
                    <td>
                        <a href="javascript:;" class="del-btn">ç§»é™¤</a>
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="text" value='æ­¦å®æ±Ÿ'>
                    </td>
                    <td>
                        <input type="number" class="price-before person">
                    </td>
                    <td>
                        <span class="add-ones-per">0.0</span>
                    </td>
                    <td>
                        <span class="price-before-discount">0.0</span>
                    </td>
                    <td>
                        <span class="price-after">0.0</span>
                    </td>
                    <td>
                        <a href="javascript:;" class="del-btn">ç§»é™¤</a>
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="text" value='å·¦åº·ç”Ÿ'>
                    </td>
                    <td>
                        <input type="number" class="price-before person">
                    </td>
                    <td>
                        <span class="add-ones-per">0.0</span>
                    </td>
                    <td>
                        <span class="price-before-discount">0.0</span>
                    </td>
                    <td>
                        <span class="price-after">0.0</span>
                    </td>
                    <td>
                        <a href="javascript:;" class="del-btn">ç§»é™¤</a>
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="text" value='å›å¤©åŠ›'>
                    </td>
                    <td>
                        <input type="number" class="price-before person">
                    </td>
                    <td>
                        <span class="add-ones-per">0.0</span>
                    </td>
                    <td>
                        <span class="price-before-discount">0.0</span>
                    </td>
                    <td>
                        <span class="price-after">0.0</span>
                    </td>
                    <td>
                        <a href="javascript:;" class="del-btn">ç§»é™¤</a>
                    </td>
                </tr>

                <tr>
                    <td style="color: red">
                        * ä¼˜æƒ é‡‘é¢ï¼š
                    </td>
                    <td>
                        <input type="number" placeholder="æ»¡å‡+çº¢åŒ…" style="width:70px;padding-right: 3px" class="reduction">
                    </td>
                    <td>
                        é¤ç›’è´¹ï¼š
                    </td>
                    <td>
                        <input type="number" class="price-before add-ones lunch-fee" value="9">
                    </td>
                    <td>
                        é…é€è´¹ï¼š
                    </td>
                    <td>
                        <input type="number" class="price-before add-ones" value="6">
                    </td>
                </tr>
                <tr>
                    <td colspan="8">
                        <span class="btn calc-btn" style="margin-left: 10px;">å¼€å§‹è®¡ç®—</span>
                        <span class="btn add-person-btn" style="margin-left: 10px">å†åŠ ä¸ªäºº</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        åˆè®¡ï¼š
                    </td>
                    <td>
                        <span class="total">0.0</span>
                    </td>
                    <td>
                        <span class="total-addones">0.0</span>
                    </td>
                    <td>
                        <span class="total-before">0.0</span>
                    </td>
                    <td>
                        <span class="total-after">0.0</span>
                    </td>
                    <td>ğŸ™‚</td>
                </tr>
            </table>
    </div>
    <script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">

        var apReduce = Array.prototype.reduce;
        function sum($elements) {
            return apReduce.call($elements, function (a, b) {
                return $(b).val() ? a + parseFloat($(b).val()) : a;
            }, 0);
        }

        var template = $('.person:last').parents('tr').clone();
        template.find('input:first').val('å§“å');

        $(document).ready(function () {
            $('.calc-btn').click(function () {
                var totalPriceBefore = sum($('.price-before')),
                    reductionPrice = $('.reduction').val() ? parseFloat($('.reduction').val()) : 0.0,
                    totalPriceAfter = totalPriceBefore - reductionPrice,
                    addOnes = sum($('.add-ones')),
                    personNum = $('.person').length,
                    addOnesPer = parseFloat((addOnes / personNum).toFixed(1));
                if (totalPriceBefore === addOnes) {
                    alert('æ²¡æœ‰äººç‚¹é¤ï¼Œå…¨æ˜¯é…é€è´¹');
                    return false;
                }
                $('.person').each(function (index, e) {
                    $(this).val() || $(this).val('0');
                    var priceBefore = parseFloat($(this).val());

                    /*
                      ä¸¤ç§ç®—æ³•ï¼Œç»“æœæ˜¯ä¸€æ ·çš„ï¼š
                      1.æ¯äººæŠ˜åä»· = (åŸä»·/(åŸæ€»ä»·-é¤è´¹-é…é€è´¹))*(æŠ˜åæ€»ä»·-é¤è´¹-é…é€è´¹)+(é¤è´¹+é…é€è´¹)/æ€»äººæ•°
                      2.æ¯äººæŠ˜åä»· = åŸä»· - (åŸä»·/(åŸæ€»ä»·-é¤è´¹-é…é€è´¹))*ä¼˜æƒ é‡‘é¢ + (é¤è´¹+é…é€è´¹)/æ€»äººæ•°;
                    */
                    var priceAfter = priceBefore / (totalPriceBefore - addOnes) * (totalPriceAfter - addOnes) + addOnesPer;
                    // var priceAfter = priceBefore - priceBefore/(totalPriceBefore - addOnes)*reductionPrice + addOnesPer;
                    var ptr = $(this).parents('tr');
                    ptr.find('.price-after').text(priceAfter ? priceAfter.toFixed(1) : 0.0);
                    ptr.find('.price-before-discount').text(priceBefore + addOnesPer);
                    $('.add-ones-per').text(addOnesPer);

                });
                $('.total').text(totalPriceBefore - addOnes);
                $('.total-addones').text(addOnes);
                $('.total-before').text(totalPriceBefore);
                $('.total-after').text(totalPriceAfter);
            });

            function changeLunchFee() {
                $('.lunch-fee').val($('.person').length * 1);
            }

            $('table').on('click', '.del-btn', function () {
                if ($('.person').length === 1) {
                    alert("åˆ«éƒ½åˆ å®Œäº†ï¼Œè‡³å°‘ç•™ä¸€ä¸ªå‘€");
                    return false;
                }
                $(this).parents('tr').remove();
                changeLunchFee();
            });

            $('.add-person-btn').click(function () {
                $('.person:last').parents('tr').after(template);
                template = template.clone();
                changeLunchFee();
            });

        })
    </script>
</body>

</html>